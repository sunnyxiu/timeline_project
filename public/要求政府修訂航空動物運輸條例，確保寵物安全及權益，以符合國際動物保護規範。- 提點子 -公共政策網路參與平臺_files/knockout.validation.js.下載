!function(){function o(a,i,t){a.isValidating(!0),i.validator(a(),t.params||!0,function(n){var r=!1,s="";a.__valid__()&&(n.message?(r=n.isValid,s=n.message):r=n,!r)&&(a.error=ko.validation.formatMessage(s||t.message||i.message,t.params),a.__valid__(r)),a.isValidating(!1)})}if(void 0===typeof ko)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";var a,i={registerExtenders:!0,messagesOnModified:!0,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,
writeInputAttributes:!1,decorateElement:!1,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",grouping:{deep:!1,observable:!0}},t=ko.utils.extend({},i),n=["required","pattern","min","max","step"],r=(new Date).getTime(),s={};a={isArray:function(a){return a.isArray||"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return null!==a&&"object"==typeof a},values:function(a){var i,t=[];for(i in a)a.hasOwnProperty(i)&&t.push(a[i]);return t},
getValue:function(a){return"function"==typeof a?a():a},hasAttribute:function(a,i){return null!==a.getAttribute(i)},isValidatable:function(a){return a.rules&&a.isValid&&a.isModified},insertAfter:function(a,i){a.parentNode.insertBefore(i,a.nextSibling)},newId:function(){return r+=1},getConfigOptions:function(i){return a.contextFor(i)||t},setDomData:function(i,t){var n=i.__ko_validation__;n||(i.__ko_validation__=n=a.newId()),s[n]=t},getDomData:function(a){return(a=a.__ko_validation__)?s[a]:void 0},contextFor:function(i){switch(i.nodeType){case 1:case 8:var t=
a.getDomData(i);if(t)return t;if(i.parentNode)return a.contextFor(i.parentNode)}},isEmptyVal:function(a){if(null==a||""===a)return!0}};var l=0;ko.validation={utils:a,init:function(a,i){0<l&&!i||((a=a||{}).errorElementClass=a.errorElementClass||a.errorClass||t.errorElementClass,a.errorMessageClass=a.errorMessageClass||a.errorClass||t.errorMessageClass,ko.utils.extend(t,a),t.registerExtenders&&ko.validation.registerExtenders(),l=1)},configure:function(a){ko.validation.init(a)},reset:function(){t=$.extend(t,
i)},group:function(i,n){n=ko.utils.extend(t.grouping,n);var r=ko.observableArray([]),s=null,l=function h(i,t){var s=[],l=ko.utils.unwrapObservable(i);t=void 0!==t?t:n.deep?1:-1,ko.isObservable(i)&&(i.isValid||i.extend({validatable:!0}),r.push(i)),l&&(a.isArray(l)?s=l:a.isObject(l)&&(s=a.values(l))),0!==t&&ko.utils.arrayForEach(s,function(a){a&&!a.nodeType&&h(a,t+1)})};return n.observable?(l(i),s=ko.computed(function(){var a=[];return ko.utils.arrayForEach(r(),function(i){i.isValid()||a.push(i.error)}),
a})):s=function(){var a=[];return r([]),l(i),ko.utils.arrayForEach(r(),function(i){i.isValid()||a.push(i.error)}),a},s.showAllMessages=function(a){null==a&&(a=!0),s(),ko.utils.arrayForEach(r(),function(i){i.isModified(a)})},i.errors=s,i.isValid=function(){return 0===i.errors().length},i.isAnyMessageShown=function(){var a=!1;return s(),ko.utils.arrayForEach(r(),function(i){!i.isValid()&&i.isModified()&&(a=!0)}),a},s},formatMessage:function(a,i){return a.replace(/\{0\}/gi,i)},addRule:function(a,i){return a.extend({validatable:!0}),
a.rules.push(i),a},addAnonymousRule:function(i,t){var n=a.newId();void 0===t.message&&(rulesObj.message="Error"),ko.validation.rules[n]=t,ko.validation.addRule(i,{rule:n,params:t.params})},addExtender:function(i){ko.extenders[i]=function(t,n){return n.message||n.onlyIf?ko.validation.addRule(t,{rule:i,message:n.message,params:!!a.isEmptyVal(n.params)||n.params,condition:n.onlyIf}):ko.validation.addRule(t,{rule:i,params:n})}},registerExtenders:function(){if(t.registerExtenders)for(var a in ko.validation.rules)ko.validation.rules.hasOwnProperty(a)&&
(ko.extenders[a]||ko.validation.addExtender(a))},insertValidationMessage:function(i){var t=document.createElement("SPAN");return t.className=a.getConfigOptions(i).errorMessageClass,a.insertAfter(i,t),t},parseInputValidationAttributes:function(i,t){ko.utils.arrayForEach(n,function(n){a.hasAttribute(i,n)&&ko.validation.addRule(t(),{rule:n,params:i.getAttribute(n)||!0})})},writeInputValidationAttributes:function(a,i){var t=i();if(t&&t.rules){var r=t.rules();ko.utils.arrayForEach(n,function(i){var t,
n=ko.utils.arrayFirst(r,function(a){return a.rule.toLowerCase()===i.toLowerCase()});n&&(t=n.params,"pattern"==n.rule&&n.params instanceof RegExp&&(t=n.params.source),a.setAttribute(i,t))}),r=null}}},ko.validation.rules={},ko.validation.rules.required={validator:function(a,i){var t;return null==a?!i:(t=a,"string"==typeof a&&(t=a.replace(/^\s+|\s+$/g,"")),i&&0<(t+"").length)},message:"This field is required."},ko.validation.rules.min={validator:function(i,t){return a.isEmptyVal(i)||i>=t},message:"Please enter a value greater than or equal to {0}."},
ko.validation.rules.max={validator:function(i,t){return a.isEmptyVal(i)||i<=t},message:"Please enter a value less than or equal to {0}."},ko.validation.rules.minLength={validator:function(i,t){return a.isEmptyVal(i)||i.length>=t},message:"Please enter at least {0} characters."},ko.validation.rules.maxLength={validator:function(i,t){return a.isEmptyVal(i)||i.length<=t},message:"Please enter no more than {0} characters."},ko.validation.rules.pattern={validator:function(i,t){return a.isEmptyVal(i)||
null!=i.match(t)},message:"Please check this value."},ko.validation.rules.step={validator:function(i,t){return a.isEmptyVal(i)||0==100*i%(100*t)},message:"The value must increment by {0}"},ko.validation.rules.email={validator:function(i,t){return a.isEmptyVal(i)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(i)},
message:"Please enter a proper email address"},ko.validation.rules.emailS1={validator:function(i,t){return!!a.isEmptyVal(i)||!(!t||!/^[a-z0-9+_-]+(?:\.[a-z0-9+_-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)*[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(i))&&i.split("@")[0].length<=64},message:"電子信箱格式錯誤"},ko.validation.rules.mobileTW={validator:function(i,t){return!!a.isEmptyVal(i)||!(!t||!/^09\d{8}$/.test(i))},message:"手機格式錯誤"},ko.validation.rules.date={validator:function(i,t){return a.isEmptyVal(i)||t&&!/Invalid|NaN/.test(new Date(i))},
message:"Please enter a proper date"},ko.validation.rules.dateISO={validator:function(i,t){return a.isEmptyVal(i)||t&&/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(i)},message:"Please enter a proper date"},ko.validation.rules.number={validator:function(i,t){return a.isEmptyVal(i)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(i)},message:"Please enter a number"},ko.validation.rules.digit={validator:function(i,t){return a.isEmptyVal(i)||t&&/^\d+$/.test(i)},message:"Please enter a digit"},ko.validation.rules.phoneUS=
{validator:function(i,t){return"string"==typeof i&&(!!a.isEmptyVal(i)||(i=i.replace(/\s+/g,""),t&&9<i.length&&i.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)))},message:"Please specify a valid phone number"},ko.validation.rules.equal={validator:function(i,t){return i===a.getValue(t)},message:"Values must equal"},ko.validation.rules.notEqual={validator:function(i,t){return i!==a.getValue(t)},message:"Please choose another value."},ko.validation.rules.unique={validator:function(i,
t){var n=a.getValue(t.collection),r=a.getValue(t.externalValue),s=0;return!i||!n||(ko.utils.arrayFilter(ko.utils.unwrapObservable(n),function(a){i===(t.valueAccessor?t.valueAccessor(a):a)&&s++}),s<(void 0!==r&&i!==r?1:2))},message:"Please make sure the value is unique."},ko.validation.registerExtenders(),ko.bindingHandlers.validationCore={init:function(i,t){var n=a.getConfigOptions(i);if(n.parseInputAttributes){var e=function(){ko.validation.parseInputValidationAttributes(i,t)};window.setImmediate?
window.setImmediate(e):window.setTimeout(e,0)}n.insertMessages&&a.isValidatable(t())&&(e=ko.validation.insertValidationMessage(i),n.messageTemplate?ko.renderTemplate(n.messageTemplate,{field:t()},null,e,"replaceNode"):ko.applyBindingsToNode(e,{validationMessage:t()})),n.writeInputAttributes&&a.isValidatable(t())&&ko.validation.writeInputValidationAttributes(i,t),n.decorateElement&&a.isValidatable(t())&&ko.applyBindingsToNode(i,{validationElement:t()})},update:function(){}};var u=ko.bindingHandlers.value.init;
ko.bindingHandlers.value.init=function(a,i,t,n,r){return u(a,i,t),ko.bindingHandlers.validationCore.init(a,i,t,n,r)},ko.bindingHandlers.validationMessage={update:function(i,t){var n,r,s=t(),l=a.getConfigOptions(i);ko.utils.unwrapObservable(s),s.extend({validatable:!0}),n=s.isModified(),r=s.isValid(),ko.bindingHandlers.text.update(i,function(){return!l.messagesOnModified||n?r?null:s.error:null}),ko.bindingHandlers.visible.update(i,function(){return!!n&&!r})}},ko.bindingHandlers.validationElement={update:function(i,
t){var n,r,s=t(),l=a.getConfigOptions(i);ko.utils.unwrapObservable(s),s.extend({validatable:!0}),n=s.isModified(),r=s.isValid(),ko.bindingHandlers.css.update(i,function(){var a={},i=!!n&&!r;return l.decorateElement||(i=!1),a[l.errorElementClass]=i,a})}},ko.bindingHandlers.validationOptions={init:function(i,n){var r=ko.utils.unwrapObservable(n());if(r){var s=ko.utils.extend({},t);ko.utils.extend(s,r),a.setDomData(i,s)}}},ko.extenders.validation=function(i,t){return ko.utils.arrayForEach(a.isArray(t)?
t:[t],function(a){ko.validation.addAnonymousRule(i,a)}),i},ko.extenders.validatable=function(i,t){if(t&&!a.isValidatable(i)){i.error=null,i.rules=ko.observableArray(),i.isValidating=ko.observable(!1),i.__valid__=ko.observable(!0),i.isModified=ko.observable(!1);var n=ko.computed(function(){return i(),i.rules(),ko.validation.validateObservable(i),!0});i.isValid=ko.computed(function(){return i.__valid__()});var r=i.subscribe(function(){i.isModified(!0)});i._disposeValidation=function(){i.isValid.dispose(),
i.rules.removeAll(),i.isModified._subscriptions.change=[],i.isValidating._subscriptions.change=[],i.__valid__._subscriptions.change=[],r.dispose(),n.dispose(),delete i.rules,delete i.error,delete i.isValid,delete i.isValidating,delete i.__valid__,delete i.isModified}}else!1===t&&a.isValidatable(i)&&i._disposeValidation&&i._disposeValidation();return i},ko.validation.validateObservable=function(a){for(var i,t,n=0,r=a.rules(),s=r.length;n<s;n++)if(!(t=r[n]).condition||t.condition())if((i=ko.validation.rules[t.rule]).async||
t.async)o(a,i,t);else{var l;if(l=a,i.validator(l(),void 0===t.params||t.params)?l=!0:(l.error=ko.validation.formatMessage(t.message||i.message,t.params),l.__valid__(!1),l=!1),!l)return!1}return a.error=null,a.__valid__(!0),!0},ko.validatedObservable=function(a){if(!ko.validation.utils.isObject(a))return ko.observable(a).extend({validatable:!0});var i=ko.observable(a);return i.errors=ko.validation.group(a),i.isValid=ko.computed(function(){return 0===i.errors().length}),i},ko.validation.localize=function(a){for(var i in a)ko.validation.rules.hasOwnProperty(i)&&
(ko.validation.rules[i].message=a[i])},ko.applyBindingsWithValidation=function(a,i,t){var n,r,s=arguments.length;2<s?(n=i,r=t):2>s?n=document.body:arguments[1].nodeType?n=i:r=arguments[1],ko.validation.init(),r&&ko.validation.utils.setDomData(n,r),ko.applyBindings(a,i)};var d=ko.applyBindings;ko.applyBindings=function(a,i){ko.validation.init(),d(a,i)}}();