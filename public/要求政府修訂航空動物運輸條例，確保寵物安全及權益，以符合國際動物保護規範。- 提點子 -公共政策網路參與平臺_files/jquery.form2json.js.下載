(function($){var defaults={inputSelectors:"input:not([type\x3dradio], [type\x3dcheckbox], [type\x3dreset]), input[type\x3dcheckbox], input[type\x3dradio]:checked, textarea, select",multiValSelector:"[type\x3dcheckbox], select",keyAttr:"name",wrapped:false,allowEmptyMultiVal:false,allowEmptySingleVal:true,keyTransform:null},settings={},empty=function(obj){if(obj&&obj.length)return obj.length===0;for(var key in obj)if(hasOwnProperty.call(obj,key))return false;return true};$.fn.form2json=function(options){var form=
$(this);if(!form.is("form"))return;settings=$.extend(true,{},defaults,options);var data={},fields=form.find(settings.inputSelectors),singleVal=fields.filter(":not("+settings.multiValSelector+")"),multiVal=fields.filter(settings.multiValSelector);singleVal.each(function(){var item=$(this),key=item.attr(settings.keyAttr)||item.attr("name")||item.attr("id"),val=item.val();if(!settings.allowEmptySingleVal&&empty(val))return true;if(key){var keyHierarchy=key.split("."),dKeys=$.map(keyHierarchy,function(k){return $.isFunction(settings.keyTransform)?
settings.keyTransform(k,item):k}),obj=data,prop;while(prop=dKeys.shift()){obj[prop]=obj[prop]||{};if(dKeys.length)obj=obj[prop];else break}obj[prop]=val}});multiVal.each(function(){var item=$(this),key=item.attr(settings.keyAttr)||item.attr("name")||item.attr("id"),val=item.is(":checkbox:not(:checked)")?null:item.val();if(key&&(val||settings.allowEmptyMultiVal)){var keyHierarchy=key.split("."),dKeys=$.map(keyHierarchy,function(k){return $.isFunction(settings.keyTransform)?settings.keyTransform(k,
item):k}),obj=data,prop;while(prop=dKeys.shift()){obj[prop]=obj[prop]||(dKeys.length?{}:null);if(dKeys.length)obj=obj[prop];else break}if(obj[prop]){if(val){$.isArray(obj[prop])||(obj[prop]=[obj[prop]]);obj[prop].push(val)}}else obj[prop]=val}});if(!settings.wrapped)return data;var ajax={data:data},method=form.attr("method"),action=form.attr("action");method&&method.toUpperCase()!="GET"&&(ajax.type=method);action&&(ajax.url=action);return ajax}})(jQuery);